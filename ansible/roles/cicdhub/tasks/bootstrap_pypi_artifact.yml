- name: Create Bootstrap PyPi Directory
  file:
    path: "/tmp/bootstrap_pypi"
    state: directory

- name: Clear target PyPi project directory (if exists already)
  file: 
    path: "/tmp/bootstrap_pypi/{{pypi_project_def.name}}"
    state: absent

- name: Create target PyPi directory
  file: 
    path: "/tmp/bootstrap_pypi/{{pypi_project_def.name}}"
    state: directory

- name: Copy PyPi Project content
  copy:
    src: "{{ pypi_project_def.content }}"
    dest: "/tmp/bootstrap_pypi/{{pypi_project_def.name}}"
    directory_mode: yes

- name: Upload Artifact
  shell: "python -m twine upload --repository-url {{ cicdhub_addr_nexus }}/repository/pypi/ -u admin -p admin123 /tmp/bootstrap_pypi/{{pypi_project_def.name}}/{{ pypi_project_def.content | basename }}"
